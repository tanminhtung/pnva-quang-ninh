<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz1_Pv7nnFw5Ylh-HFE-BxxdQYXX8FIIuesc239s6helZOfI27WwfLMbRvQfDWSk3wrZg/exec";

async function loadTable() {
    const container = document.getElementById("table-container");

    try {
        const res = await fetch(SCRIPT_URL);
        const json = await res.json();
        const data = json.data;

        const table = document.createElement("table");

        let headerFound = false;
        let dataRowCounter = 0;

        data.forEach((row) => {
            if (!row || row.length === 0) return;

            // Láº¥y text Ã´ STT (Ã´ Ä‘áº§u tiÃªn)
            const firstCell = row[0];
            const firstText = firstCell && firstCell.text
                ? firstCell.text.toString().trim()
                : "";

            // XÃ¡c Ä‘á»‹nh hÃ ng header: Ã´ Ä‘áº§u tiÃªn cÃ³ text "STT"
            const isHeaderRow = !headerFound && firstText.toUpperCase() === "STT";

            // HÃ m check hÃ ng cÃ³ báº¥t ká»³ ná»™i dung nÃ o (text hoáº·c image)
            const hasAnyContent = row.some((cell) =>
                cell &&
                (
                    (cell.text && cell.text.toString().trim() !== "") ||
                    (cell.imageUrls && cell.imageUrls.length > 0)
                )
            );

            // ðŸ”¹ TrÆ°á»›c khi gáº·p header:
            //   â€“ náº¿u hÃ ng hoÃ n toÃ n trá»‘ng thÃ¬ bá» qua
            if (!headerFound && !isHeaderRow && !hasAnyContent) {
                return;
            }

            // ðŸ”¹ Sau khi Ä‘Ã£ cÃ³ header:
            //   â€“ Náº¿u KHÃ”NG pháº£i header
            //   â€“ VÃ€ (khÃ´ng cÃ³ ná»™i dung hoáº·c Ã´ STT rá»—ng) â†’ bá» qua (Ä‘Ã¢y chÃ­nh lÃ  cÃ¡c dÃ²ng tráº¯ng cuá»‘i)
            if (headerFound && !isHeaderRow) {
                const hasSTT = firstText !== "";
                if (!hasAnyContent || !hasSTT) {
                    return;
                }
            }

            const tr = document.createElement("tr");

            if (isHeaderRow) {
                tr.classList.add("header-row");
                headerFound = true;
            } else if (headerFound) {
                dataRowCounter++;
                tr.classList.add("data-row");
                tr.classList.add(dataRowCounter % 2 === 0 ? "data-even" : "data-odd");
            }

            row.forEach((cell) => {
                const cellEl = document.createElement(isHeaderRow ? "th" : "td");

                if (cell && cell.imageUrls && cell.imageUrls.length > 0) {
                    const img = document.createElement("img");
                    img.src = cell.imageUrls[0];
                    img.className = "sheet-img";
                    cellEl.appendChild(img);
                }

                if (cell && cell.text && cell.text.toString().trim() !== "") {
                    cellEl.appendChild(document.createTextNode(cell.text));
                }

                tr.appendChild(cellEl);
            });

            table.appendChild(tr);
        });

        container.innerHTML = "";
        container.appendChild(table);

    } catch (err) {
        console.error(err);
        container.textContent = "Lá»—i táº£i dá»¯ liá»‡u!";
    }
}

loadTable();
</script>
