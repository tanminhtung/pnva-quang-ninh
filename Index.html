<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Pickleball Viewer ‚Äì JSON</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000000;
      color: #ffffff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 6px 10px;
      text-align: center;
      font-weight: 700;
      font-size: 18px;
      border-bottom: 1px solid #333;
      background: #111;
    }

    .table-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: auto;
      background: #000;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
      font-size: 14px;
      color: #ffffff;
    }

    thead {
      position: sticky;
      top: 0;
      background: #222;
      z-index: 1;
    }

    th, td {
      padding: 6px 4px;
      text-align: center;
      border-bottom: 1px solid #333;
      word-wrap: break-word;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* h√†ng ch·∫µn / l·∫ª xen k·∫Ω */
    tbody tr:nth-child(even) td {
      background: #141414;
    }

    tbody tr:nth-child(odd) td {
      background: #050505;
    }

    /* c·ªôt 2 (t√™n VƒêV) cƒÉn tr√°i */
    td.name, th.name {
      text-align: left;
    }

    /* c·ªôt cu·ªëi h·∫πp h∆°n (QR / ghi ch√∫) */
    td.last-col, th.last-col {
      width: 90px;
    }

    .footer {
      padding: 4px 8px;
      font-size: 12px;
      border-top: 1px solid #333;
      background: #111;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .note {
      text-align: left;
      color: #cccccc;
    }

    .updated {
      text-align: right;
      font-style: italic;
      color: #999999;
    }

    @media (orientation: landscape) {
      table {
        font-size: 16px;
      }
      .header {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    B·∫¢NG X·∫æP H·∫†NG PICKLEBALL
  </div>

  <div id="table-container" class="table-container">
    <table id="ranking-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footer">
    <div class="note">
      Ghi ch√∫: Viewer t·ª± c·∫≠p nh·∫≠t t·ª´ Google Sheets (Apps Script JSON)
    </div>
    <div class="updated" id="last-updated">
      ƒêang t·∫£i d·ªØ li·ªáu...
    </div>
  </div>

  <script>
    // üîó D√ÅN URL APPS SCRIPT WEB APP C·ª¶A B·∫†N V√ÄO ƒê√ÇY
    // VD: const API_URL = "https://script.google.com/macros/s/XXXX/exec";
    const API_URL = https://script.google.com/macros/s/AKfycbwGTNySpFkDv0q19ykb5SeFg0BmTY4d7vCc6DIRu26fP2MV7bupxDbBPL8T1slopgIdLw/exec;

    // Chu k·ª≥ refresh (ms) ‚Äì t√πy b·∫°n, 5000 = 5s, 10000 = 10s
    const REFRESH_MS = 10000;

    const container = document.getElementById("table-container");
    const table = document.getElementById("ranking-table");
    const thead = table.querySelector("thead");
    const tbody = table.querySelector("tbody");
    const updatedEl = document.getElementById("last-updated");

    async function fetchData() {
      const res = await fetch(API_URL + "?t=" + Date.now(), {
        cache: "no-store",
      });
      if (!res.ok) {
        throw new Error("Fetch JSON l·ªói: " + res.status);
      }
      // Apps Script tr·∫£ v·ªÅ m·∫£ng 2D: [[header1, header2,...], [row1...], ...]
      const data = await res.json();
      return data;
    }

    function renderTable(data) {
      thead.innerHTML = "";
      tbody.innerHTML = "";

      if (!data || data.length === 0) return;

      const headerCells = data[0];

      const headerRow = document.createElement("tr");
      headerCells.forEach((cell, idx) => {
        const th = document.createElement("th");
        th.textContent = cell || "";
        if (idx === 1) th.classList.add("name");              // c·ªôt 2: t√™n VƒêV
        if (idx === headerCells.length - 1) th.classList.add("last-col"); // c·ªôt cu·ªëi
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);

      for (let i = 1; i < data.length; i++) {
        const rowData = data[i];
        if (!rowData || rowData.every((c) => !c || c === "")) continue;

        const tr = document.createElement("tr");
        rowData.forEach((cell, idx) => {
          const td = document.createElement("td");
          td.textContent = cell || "";
          if (idx === 1) td.classList.add("name");
          if (idx === rowData.length - 1) td.classList.add("last-col");
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      }

      const now = new Date();
      updatedEl.textContent =
        "C·∫≠p nh·∫≠t: " +
        now.toLocaleTimeString("vi-VN", {
          hour: "2-digit",
          minute: "2-digit",
          second: "2-digit",
        });
    }

    async function loadData() {
      // üîÅ GI·ªÆ V·ªä TR√ç CU·ªòN TR∆Ø·ªöC KHI UPDATE
      const prevScrollTop = container.scrollTop;

      try {
        const data = await fetchData();
        renderTable(data);
        // üîÅ KH√îI PH·ª§C V·ªä TR√ç CU·ªòN
        container.scrollTop = prevScrollTop;
      } catch (err) {
        console.error(err);
        updatedEl.textContent = "L·ªói t·∫£i d·ªØ li·ªáu";
      }
    }

    loadData();
    setInterval(loadData, REFRESH_MS);
  </script>
</body>
</html>
