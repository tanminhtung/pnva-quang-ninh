<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Pickleball Viewer – JSON</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    .header {
      padding: 8px 12px;
      text-align: center;
      font-weight: 700;
      font-size: 20px;
      background: #111;
      border-bottom: 1px solid #333;
    }

    .table-container {
      flex: 1;
      overflow-y: auto;
      overflow-x: auto;
      background: #000;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
      font-size: 15px;
    }

    thead {
      position: sticky;
      top: 0;
      background: #222;
      z-index: 10;
    }

    th, td {
      padding: 6px 4px;
      border-bottom: 1px solid #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      text-align: center;
    }

    tbody tr:nth-child(even) td {
      background: #151515;
    }
    tbody tr:nth-child(odd) td {
      background: #050505;
    }

    td.name, th.name {
      text-align: left;
    }

    td.last-col, th.last-col {
      width: 90px;
    }

    .footer {
      padding: 6px 10px;
      font-size: 12px;
      background: #111;
      border-top: 1px solid #333;
      display: flex;
      justify-content: space-between;
      color: #ccc;
    }
  </style>
</head>

<body>
  <div class="header">BẢNG XẾP HẠNG PICKLEBALL</div>

  <div id="table-container" class="table-container">
    <table id="ranking-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="footer">
    <div>Auto update</div>
    <div id="last-updated">Đang tải...</div>
  </div>

<script>
  /* ⭐⭐⭐ DÁN URL APPS SCRIPT JSON CỦA BẠN VÀO ĐÂY ⭐⭐⭐ */
  const API_URL = https://script.google.com/macros/s/AKfycbwGTNySpFkDv0q19ykb5SeFg0BmTY4d7vCc6DIRu26fP2MV7bupxDbBPL8T1slopgIdLw/exec;

  /* Thời gian refresh (ms). 5000 = 5 giây */
  const REFRESH_MS = 5000;

  const container = document.getElementById("table-container");
  const table = document.getElementById("ranking-table");
  const thead = table.querySelector("thead");
  const tbody = table.querySelector("tbody");
  const updatedEl = document.getElementById("last-updated");

  async function fetchData() {
    const res = await fetch(API_URL + "?t=" + Date.now(), { cache: "no-store" });
    if (!res.ok) throw new Error("Lỗi: " + res.status);
    return await res.json(); // Mảng 2D
  }

  function renderTable(data) {
    thead.innerHTML = "";
    tbody.innerHTML = "";

    if (!data || data.length === 0) return;

    const headerRow = document.createElement("tr");
    data[0].forEach((h, idx) => {
      const th = document.createElement("th");
      th.textContent = h;
      if (idx === 1) th.classList.add("name");
      if (idx === data[0].length - 1) th.classList.add("last-col");
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);

    for (let i = 1; i < data.length; i++) {
      const row = data[i];
      if (!row || row.every(c => !c)) continue;

      const tr = document.createElement("tr");
      row.forEach((cell, idx) => {
        const td = document.createElement("td");
        td.textContent = cell;
        if (idx === 1) td.classList.add("name");
        if (idx === row.length - 1) td.classList.add("last-col");
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    }

    updatedEl.textContent = "Cập nhật: " + new Date().toLocaleTimeString("vi-VN");
  }

  async function loadData() {
    const prevScrollTop = container.scrollTop;

    try {
      const data = await fetchData();
      renderTable(data);
      container.scrollTop = prevScrollTop;
    } catch (err) {
      updatedEl.textContent = "Lỗi tải dữ liệu...";
      console.error(err);
    }
  }

  loadData();
  setInterval(loadData, REFRESH_MS);

</script>
</body>
</html>
